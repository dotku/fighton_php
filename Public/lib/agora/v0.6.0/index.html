<!DOCTYPE html>
<html>
<head>
<title>Agora Sample</title>
<link rel="stylesheet" href="vendor/bootstrap.min.css">
</head>

<body>
<script src="vendor/jquery.js"></script>
<script src="vendor/socket.io.js"></script>
<script src="vendor/adapter.js"></script>
<script src="AgoraRTCSDK.js"></script>
<script language="javascript">
var client, localStream;

function join() {
  document.getElementById("join").disabled = true;
  document.getElementById("video").disabled = true;
  console.log("Init AgoraRTC client with vendor key: " + key.value);
  client = AgoraRTC.createClient();
  client.init(key.value, function () {
    console.log("AgoraRTC client initialized");
    var token = undefined;
    client.join(token, channel.value, function(uid) {
      console.log("User " + uid + " join channel successfully");
      localStream = AgoraRTC.createStream({streamID: uid, audio: true, video: document.getElementById("video").checked, screen: false});
      localStream.init(function() {
        console.log("getUserMedia successfully");
        localStream.play('agora_local');

        client.publish(localStream, function (err) {
          console.log("Publish local stream error: " + err);
        });

        client.on('stream-published', function (evt) {
          console.log("Publish local stream successfully");
        });
      }, function (err) {
        console.log("getUserMedia failed", err);
      });

    }, function(err) {
      console.log("Join channel failed", err);
    });
  }, function (err) {
    console.log("AgoraRTC client init failed", err);
  });

  client.on('stream-added', function (evt) {
    var stream = evt.stream;
    console.log("New stream added: " + stream.getId());
    console.log("Subscribe ", stream);
    client.subscribe(stream, function (err) {
      console.log("Subscribe stream failed", err);
    });
  });

  client.on('stream-subscribed', function (evt) {
    var stream = evt.stream;
    console.log("Subscribe remote stream successfully: " + stream.getId());
    if ($('div#video #agora_remote'+stream.getId()).length === 0) {
      $('div#video').append('<div id="agora_remote'+stream.getId()+'" style="width:320px;height:240px"></div>');
    }
    stream.play('agora_remote' + stream.getId());
  });
}

function leave() {
  document.getElementById("leave").disabled = true;
  client.leave(function () {
    console.log("Leavel channel successfully");
  }, function (err) {
    console.log("Leave channel failed");
  });
}
</script>
<div id="div_join" class="panel panel-default">
<div class="panel-body">
Key: <input id="key" type="text" value="6D7A26A1D3554A54A9F43BE6797FE3E2" size="36"></input>
Channel: <input id="channel" type="text" value="1000" size="4"></input>
Video: <input id="video" type="checkbox"></input>
<button id="join" class="btn btn-primary" onclick="join()">Join</button>
<button id="leave" class="btn btn-primary" onclick="leave()">Leave</button>
</div>
</div>

<div id="video">
<div id="agora_local" style="width:320px;height:240px"></div>
</div>

</body>
</html>
